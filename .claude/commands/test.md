Write tests for this code. Include:
- Happy path cases
- Edge cases (empty, nil, zero, max values)
- Error conditions
- Table-driven tests where appropriate (Go)
- Mocks/stubs for external dependencies

Follow existing test patterns in this repo.
