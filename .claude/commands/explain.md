Explain this code. Cover:
- What it does (high-level purpose)
- How it works (key mechanisms)
- Why it's designed this way (tradeoffs, patterns used)
- Dependencies and side effects
- Anything surprising or non-obvious
