#!/bin/bash
# Undo last commit(s) but keep changes staged
# Usage: uncommit [n]  - undo last n commits (default 1)

n="${1:-1}"

if ! git rev-parse --git-dir &>/dev/null; then
  echo "Not in a git repository" >&2
  exit 1
fi

# Show what we're about to undo
echo -e "\033[38;5;221mUndoing:\033[0m"
git log --oneline -n "$n"
echo

git reset --soft "HEAD~$n"

echo -e "\033[38;5;51mChanges are now staged:\033[0m"
git diff --cached --stat
